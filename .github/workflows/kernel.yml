name: Build kernel

on: 
  workflow_dispatch:


jobs:

  build:
    runs-on: ubuntu-20.04

   
    steps:
    - name: Checkout
      uses: actions/checkout@main

    - name: Build Environment
      run: |
        git clone https://github.com/cd-Spidey/Random ./setting
        cd setting/setup/packages
        sudo bash build_env.sh
        sudo bash open_jdk.sh

    - name: Git-Repo
      run: |
        git config --global advice.detachedHead false
        git clone https://android.googlesource.com/tools/repo -b v2.29 ~/bin
        chmod a+x ~/bin/repo
        sudo ln -sf ~/bin/repo /usr/bin/repo

    - name: Set Properties # Output will be use in final name of recovery.
      id: props
      run: |
        echo "date=$(date +%Y%m%d)" >> $GITHUB_OUTPUT
      
    - name: Start
      run: |
        ./build
        curl -F document=@"$(echo /home/runner/work/ANY/*.zip)" https://api.telegram.org/bot"${{ secrets.TOKEN_BOT }}"/sendDocument?chat_id=-853780494 > /dev/null 2>&1

    - name: Upload to Release
      uses: ncipollo/release-action@v1.11.1
      with:
        artifacts: /home/runner/work/ANY/*.zip
        name: Action-Kernel-Builder Release
        draft: false
        prerelease: false
        tag: ${{ github.run_id }}-${{ steps.props.outputs.date }}
        token: ${{ secrets.GITHUB_TOKEN }}
        body: |
          ## All Package of Out-Dir Kernel
